<!DOCTYPE html>
{% load static %}
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="viewport" content="initial-scale=1, maximum-scale=1" />
    <title>{% block title %} Ziber Autohub {% endblock %}</title>

    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <link
      rel="stylesheet"
      type="text/css"
      href="{% static 'css/bootstrap.min.css' %}"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="{% static 'css/style.css' %}"
    />
    <link rel="stylesheet" href="{% static 'css/responsive.css' %}" />
    <link
      rel="icon"
      href="{% static 'images/fevicon.png' %}"
      type="image/gif"
    />
    <link
      rel="stylesheet"
      href="{% static 'css/jquery.mCustomScrollbar.min.css' }"
    />
    {# Using Font Awesome 6 for more modern icons and better compatibility #}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <link
      href="https://fonts.googleapis.com/css?family=Poppins:400,700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Great+Vibes|Poppins:400,700&display=swap&subset=latin-ext"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="{% static 'css/owl.carousel.min.css' %}" />
    <link
      rel="stylesoeet"
      href="{% static 'css/owl.theme.default.min.css' %}"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css"
      media="screen"
    />

    {% block extra_styles %} {% endblock %}
  </head>
  <body>
    <div class="banner_bg_main">
      <div class="container">
        <div class="header_section_top">
          <div class="row">
            <div class="col-sm-12">
              <div class="custom_menu">
                <ul>
                  <li><a href="{% url 'hub:new_car_list' %}">New Releases</a></li>
                  <li><a href="{% url 'hub:car_list' %}">All Vehicles</a></li>
                  <li><a href="{% url 'hub:used_car_list' %}">Used Cars</a></li> 
                  <li><a href="{% url 'hub:book_service' %}">Service Booking</a></li> 
                  <li><a href="{% url 'hub:my_service_bookings' %}">My Service</a></li>
                  <li><a href="{% url 'hub:predict_price' %}">Price Predictor</a></li>
                  <li><a href="{% url 'hub:job_list' %}">Careers</a></li>
                  <li><a href="{% url 'hub:news' %}">News</a></li>
                  <li><a href="{% url 'hub:service_chatbot' %}">Chat Bot</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="logo_section">
        <div class="container">
          <div class="row">
            <div class="col-sm-12">
              <div class="logo">
                <a href="{% if user.is_authenticated %}{% url 'hub:home' %} {% else %} {% url 'hub:demo' %}{% endif %}"> <h1 class="text-white">Ziber Autohub</h1></a>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="header_section my-3">
        <div class="container">
          <div class="containt_main">
            <div id="mySidenav" class="sidenav">
              <a href="javascript:void(0)" class="closebtn" onclick="closeNav()"
                >&times;</a
              >
              <a href="{% url 'hub:home' %}">Home</a>
              <a href="{% url 'hub:car_list' %}">All Vehicles</a>
              <a href="{% url 'hub:new_car_list' %}">New Releases</a>
              <a href="{% url 'hub:used_car_list' %}">Used Cars</a> <a href="{% url 'hub:predict_price' %}">Price Predictor</a>
              <a href="{% url 'hub:book_service' %}">Services</a>
              <a href="{% url 'hub:job_list' %}">Careers</a>
              <a href="{% url 'hub:news' %}">News</a>
              {% if user.is_authenticated %}
                <a href="{% url 'hub:view_cart' %}">My Cart</a>
                <a href="{% url 'hub:order_history' %}">My Orders</a>
                <a href="{% url 'hub:my_bookings' %}">My Bookings</a>
                <a href="{% url 'hub:my_prebookings' %}">My Pre-Bookings</a> {% if user.is_staff %}
                  <a href="{% url 'hub:create_job_vacancy' %}">Post Job</a>
                {% endif %}
              {% endif %}
            </div>
            <span class="toggle_icon" onclick="openNav()">
              <img src="{% static 'images/toggle-icon.png' %}" alt="toggle icon"/>
            </span>
            <div class="dropdown">
              <button
                class="btn btn-secondary dropdown-toggle"
                type="button"
                id="dropdownMenuButton"
                data-bs-toggle="dropdown" {# Changed from data-toggle to data-bs-toggle #}
                aria-haspopup="true"
                aria-expanded="false"
              >
                Quick Links
              </button>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <a class="dropdown-item" href="{% url 'hub:car_list' %}">All Vehicles</a>
                <a class="dropdown-item" href="{% url 'hub:new_car_list' %}">New Releases</a>
                <a class="dropdown-item" href="{% url 'hub:used_car_list' %}">Used Cars</a> <a class="dropdown-item" href="{% url 'hub:predict_price' %}">Price Predictor</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="{% url 'hub:book_service' %}">Book Service</a>
                <a class="dropdown-item" href="{% url 'hub:job_list' %}">Career Opportunities</a>
              </div>
            </div>
            <div class="main">
              <form action="{% url 'hub:car_list' %}" method="get">
                <div class="input-group">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Search vehicles..."
                    name="q"
                    required
                  />
                  <div class="input-group-append">
                    <button class="btn btn-secondary" type="submit">
                      <i class="fa fa-search"></i>
                    </button>
                  </div>
                </div>
              </form>
            </div>
            <div class="header_box">
                    {% if user.is_authenticated %}
                      <div class="login_menu">
                        <ul>
                          {% comment %} <a href="{% url 'hub:my_chats' %}">My Chats</a> {% endcomment %}
                            <li class="mx-1"><a href="{% url 'hub:view_cart' %}">
                                <i class="fa fa-shopping-cart" aria-hidden="true"></i>
                                <span class="padding_10">Cart</span></a>
                            </li>
                            <li class="mx-1">
                                {# Changed logout link to trigger modal #}
                                <a href="#" data-bs-toggle="modal" data-bs-target="#logoutConfirmModal">
                                    <i class="fa fa-user" aria-hidden="true"></i>
                                    <span class="padding_10">Logout</span>
                                </a>
                            </li>
                        </ul>
                      </div>
                    {% else %}
                      <div class="login_menu">
                        <ul>
                           <li><a href="{% url 'hub:register' %}"><i class="fa fa-user-plus"></i><span class="padding_10 mx-1">Register</span></a></li>

                           <li><a href="{% url 'hub:login' %}"><i class="fa fa-user"></i><span class="padding_10 mx-1">Login</span></a></li>
                        </ul>
                      </div>
                    {% endif %}
                </div>
            </div>
        </div>
      </div>
      </div>
    {% block content %} {% endblock %}

    <div class="footer_section layout_padding">
      <div class="container">
        <div class="footer_logo">
         <a href="{% url 'hub:home' %}"> <h1 class="text-white fw-bold">Ziber Autohub</h1></a>
        </div>
        <div class="input_bt">
          <input
            type="email" {# Changed type to email for basic browser validation #}
            class="mail_bt"
            placeholder="Your Email"
            name="Your Email"
            id="subscribeEmailInput" {# ADDED ID #}
          />
          <span class="subscribe_bt" id="subscribeButton"> {# ADDED ID #}
            <a href="#">Subscribe</a>
          </span>
        </div>
        <div class="footer_menu">
          <ul>
            <li><a href="{% url 'hub:new_car_list' %}">New Releases</a></li>
            <li><a href="{% url 'hub:car_list' %}">All Vehicles</a></li>
            <li><a href="{% url 'hub:used_car_list' %}">Used Cars</a></li> <li><a href="{% url 'hub:book_service' %}">Service Booking</a></li>
            <li><a href="{% url 'hub:my_service_bookings' %}">My Service</a></li>
            <li><a href="{% url 'hub:predict_price' %}">Price Predictor</a></li>
            <li><a href="{% url 'hub:job_list' %}">Careers</a></li>
            <li><a href="{% url 'hub:news' %}">News</a></li>
          </ul>
        </div>
        <div class="location_main">
          Help Line Number : <a href="#">+1 1800 1200 1200</a>
        </div>
      </div>
    </div>
    <div class="copyright_section">
      <div class="container">
        <p class="copyright_text">
          © 2025 All Rights Reserved. Design by
          <a href="#">Ziber Autohub</a>
        </p>
      </div>
    </div>

    {# Logout Confirmation Modal #}
    <div class="modal fade" id="logoutConfirmModal" tabindex="-1" aria-labelledby="logoutConfirmModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="logoutConfirmModalLabel">Confirm Logout</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to log out?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <a href="{% url 'hub:logout' %}" id="confirmLogoutButton" class="btn btn-danger">Logout</a>
                </div>
            </div>
        </div>
    </div>

    {# Subscription Confirmation Modal - NEW #}
    <div class="modal fade" id="subscriptionConfirmModal" tabindex="-1" aria-labelledby="subscriptionConfirmModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="subscriptionConfirmModalLabel">Subscription Status</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="subscriptionModalBody">
                    {# Content will be inserted by JavaScript #}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">OK</button>
                </div>
            </div>
        </div>
    </div>

    {% block scripts %}
    {# Bootstrap 5 Bundle JS (includes Popper.js) - this is essential for modals and dropdowns #}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    {# Your custom scripts - load them AFTER Bootstrap #}
    {# Only include jQuery if absolutely necessary for these files. If not, remove it. #}
    <script src="{% static 'js/jquery.min.js' %}"></script> {# Keep this only if plugin.js, custom.js, custom_base.js require it #}
    <script src="{% static 'js/plugin.js' %}"></script>
    <script src="{% static 'js/jquery.mCustomScrollbar.concat.min.js' %}"></script>
    <script src="{% static 'js/custom.js' %}"></script>
    <script src="{% static 'js/custom_base.js' %}"></script>
    
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Select all message alerts
        const messageAlerts = document.querySelectorAll('.alert');

        // Iterate over each alert and set a timeout
        messageAlerts.forEach(function(alert) {
          // Check if the alert has a dismissible class (optional, but good practice)
          // or if it's a success/info/warning message that should disappear
          if (alert.classList.contains('alert-success') ||
              alert.classList.contains('alert-info') ||
              alert.classList.contains('alert-warning')) { // You can customize which types disappear
            setTimeout(function() {
              // Use Bootstrap's built-in dismiss functionality
              const bsAlert = bootstrap.Alert.getInstance(alert) || new bootstrap.Alert(alert);
              bsAlert.close();
            }, 5000); // 5000 milliseconds = 5 seconds
          }
        });

        // Optional: Add logging to confirm Bootstrap is available
        console.log('Bootstrap object:', typeof bootstrap !== 'undefined' ? bootstrap : 'Not loaded');
        if (typeof bootstrap !== 'undefined' && bootstrap.Modal) {
            console.log('Bootstrap Modal component is available.');
        } else {
            console.error('Bootstrap Modal component is NOT available. Check JS loading.');
        }

        // --- Sidenav: Click outside to close ---
        const mySidenav = document.getElementById("mySidenav");
        const toggleIcon = document.querySelector(".toggle_icon"); // Assuming this is the button that opens it

        document.addEventListener('click', function(event) {
            // Check if the sidenav is open
            if (mySidenav.style.width === "250px" || mySidenav.style.width === "100%") { // Adjust based on your openNav width
                // Check if the click was outside the sidenav AND not on the toggle button
                if (!mySidenav.contains(event.target) && !toggleIcon.contains(event.target)) {
                    closeNav(); // Call your existing close function
                }
            }
        });
        // --- End Sidenav: Click outside to close ---

        // --- New: Subscription functionality ---
        const subscribeEmailInput = document.getElementById('subscribeEmailInput');
        const subscribeButton = document.getElementById('subscribeButton');
        const subscriptionModal = new bootstrap.Modal(document.getElementById('subscriptionConfirmModal'));
        const subscriptionModalBody = document.getElementById('subscriptionModalBody');

        subscribeButton.addEventListener('click', function(event) {
            event.preventDefault(); // Prevent default link behavior

            const email = subscribeEmailInput.value;
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; // Simple email regex

            if (emailRegex.test(email)) {
                // Valid email
                subscriptionModalBody.innerHTML = `<p class="text-success">You have successfully subscribed!</p><p>Email: <strong>${email}</strong></p>`;
                subscriptionModal.show();
                subscribeEmailInput.value = ''; // Clear the input field
            } else {
                // Invalid email
                subscriptionModalBody.innerHTML = `<p class="text-danger">Please enter a valid email address to subscribe.</p>`;
                subscriptionModal.show();
            }
        });
        // --- End New: Subscription functionality ---

      });
    </script>
    {% endblock %}
  </body>
</html>