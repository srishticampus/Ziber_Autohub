{% extends 'base.html' %}
{% load static %}

{% block title %}Home{% endblock %}

{% block extra_styles %}
    {# Link to your new demo-specific stylesheet (if using one) #}
    <link rel="stylesheet" href="{% static 'css/demo_styles.css' %}">
    {# Include styles from news_detail.html for the integrated news section #}
    <style>
        /* General section styling */
        .news_detail_section {
            background-color: #f5f5f5;
            padding-top: 5rem; /* Adjusted padding from header */
            padding-bottom: 4rem; /* Padding before footer */
        }

        /* Styling for the static news block */
        .static_news_block {
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            padding: 2.5rem;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%; /* Ensure consistent height for single block */
        }

        .static_news_block .news_image img {
            border-radius: 8px;
            object-fit: cover;
            max-height: 250px; /* Increased max-height for better visual */
            width: 100%;
            margin-bottom: 1.5rem;
        }

        .static_news_block .news_title {
            font-size: 2.2rem; /* Larger title font */
            font-weight: bold;
            color: #333;
            margin-top: 0;
            margin-bottom: 1rem;
        }

        .static_news_block .news_content {
            font-size: 1.1rem; /* Slightly larger content font */
            color: #555;
            line-height: 1.8;
            margin-bottom: 2rem;
            max-width: 800px; /* Constrain width for readability */
            margin-left: auto;
            margin-right: auto;
        }

        /* Styles for upcoming launch items in the carousel */
        .upcoming_launch_item {
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            padding: 1.5rem;
            text-align: center;
            height: 100%; /* Ensure consistent height for carousel items */
            display: flex;
            flex-direction: column;
            justify-content: space-between; /* Space out content and button */
        }

        .upcoming_launch_item .launch-image-container {
            width: 100%;
            max-height: 200px; /* Max height for the image container */
            overflow: hidden;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .upcoming_launch_item .launch-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Cover the container, cropping if necessary */
            transition: transform 0.3s ease;
        }

        .upcoming_launch_item:hover .launch-image-container img {
            transform: scale(1.05); /* Slight zoom on hover */
        }

        .upcoming_launch_item h4 {
            font-size: 1.6rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 0.75rem;
        }

        .upcoming_launch_item p {
            font-size: 0.95rem;
            color: #666;
            line-height: 1.5;
            margin-bottom: 0.5rem;
        }

        /* Ensure the existing .product-img style doesn't interfere if you re-add images later */
        .product-img {
            width: 100%;
            height: auto;
        }

        /* Specific carousel control styles for the new launch section to match design */
        #new_launch_slider .carousel-control-prev,
        #new_launch_slider .carousel-control-next {
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            background-color: rgba(242, 101, 34, 0.8); /* Match your theme orange */
            border-radius: 50%;
            opacity: 1; /* Always visible */
            transition: background-color 0.3s ease;
        }

        #new_launch_slider .carousel-control-prev:hover,
        #new_launch_slider .carousel-control-next:hover {
            background-color: rgba(242, 101, 34, 1);
        }

        #new_launch_slider .carousel-control-prev {
            left: -20px; /* Adjust as needed for positioning */
        }

        #new_launch_slider .carousel-control-next {
            right: -20px; /* Adjust as needed for positioning */
        }
    </style>
{% endblock %}

{% block content %}
    <div class="banner_section_demo layout_padding" id="dynamicBannerBackground">
        <div class="container h-100 d-flex align-items-center justify-content-center">
            <div id="my_slider" class="carousel slide w-100" data-bs-ride="carousel" data-bs-interval="5000"> 
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <div class="row justify-content-center">
                            <div class="col-sm-12 text-center">
                                <div class="buynow_bt"><a href="{% url 'hub:car_list' %}">Buy Now</a></div>
                            </div>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <div class="row justify-content-center">
                            <div class="col-sm-12 text-center">
                                <div class="buynow_bt"><a href="{% url 'hub:used_car_list' %}">Used Cars</a></div>
                            </div>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <div class="row justify-content-center">
                            <div class="col-sm-12 text-center">
                                <div class="buynow_bt"><a href="{% url 'hub:job_list' %}">Jobs</a></div>
                            </div>
                        </div>
                    </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#my_slider" data-bs-slide="prev">
                    <i class="fa fa-angle-left"></i>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#my_slider" data-bs-slide="next">
                    <i class="fa fa-angle-right"></i>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>
    </div>

    {# START: Simplified "Latest News" section #}
    <div class="news_detail_section">
        <div class="container">
            <h2 class="text-center mb-5" style="font-size: 2.5rem; font-weight: bold; color: #333;">Stay Updated with Ziber Autohub!</h2>
            <div class="row justify-content-center">
                <div class="col-lg-8 col-md-10 mb-4">
                    <div class="static_news_block">
                        <div class="news_image">
                            {# Use a static image for the general news section. Make sure this image exists in your static/images/ folder. #}
                            <img src="{% static 'images/general_news_banner.jpg' %}" alt="Latest News" class="img-fluid">
                        </div>
                        <h3 class="news_title">Catch Up on All the Latest from the Automotive World and Ziber!</h3>
                        <p class="news_content">
                            From groundbreaking electric vehicle announcements to exclusive offers on used cars, new accessory arrivals, and expansions of our service network, find all the important updates and stories from Ziber Autohub right here. Don't miss out on industry insights and community initiatives.
                        </p>
                        <a href="{% url 'hub:news' %}" class="btn buynow_bt mt-3">
                            <i class="fas fa-newspaper me-2"></i> View All News
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {# END: Simplified "Latest News" section #}

    <div class="new_launch_section_demo layout_padding">
        <div class="container">
            <div class="text-center mb-4">
                <h2 class="text-uppercase new-launch-heading">Upcoming Car Launches</h2> {# Updated heading #}
            </div>

            <div id="new_launch_slider" class="carousel slide" data-bs-ride="carousel" data-bs-interval="5000"> 
                <div class="carousel-inner">
                    {# Loop through upcoming_launches passed from the view #}
                    {% for launch in upcoming_launches %} 
                    <div class="carousel-item {% if forloop.first %}active{% endif %}">
                        <div class="row justify-content-center">
                            <div class="col-sm-6 col-md-4 text-center"> {# Adjusted column size for better display #}
                                <div class="upcoming_launch_item"> {# Custom class for styling #}
                                    <div class="launch-image-container"> {# New container for the image #}
                                        {% if launch.image %}
                                            <img src="{{ launch.image.url }}" alt="{{ launch.car_name }} Image">
                                        {% else %}
                                            <img src="https://placehold.co/400x250/EFEFEF/AAAAAA?text=No+Launch+Image" alt="No Image Available">
                                        {% endif %}
                                    </div>
                                    <h4 class="mb-2">{{ launch.car_name }}</h4>
                                    <p class="text-muted mb-1">{{ launch.car_minimal_details|default_if_none:"" }}</p>
                                    <p style="font-size: 0.9rem; color: #555;">
                                        {{ launch.car_description|truncatechars:150 }}
                                    </p>
                                    <p class="mb-1">
                                        <strong>Launch Date:</strong> {{ launch.launch_date|date:"M d, Y" }} <br>
                                        <strong>Time:</strong> {{ launch.launch_time_start|time:"h:i A" }} - {{ launch.launch_time_end|time:"h:i A" }} <br>
                                        <strong>Venue:</strong> {{ launch.venue }}, {{ launch.location }}
                                    </p>
                                    <div class="mt-3">
                                        {# Link to a general launches list, as specific detail pages might not exist yet #}
                                        <a href="{% url 'admin_panel:upcoming_launch_list' %}" class="btn buynow_bt btn-sm">View All Launches</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    {# Fallback if no upcoming launches are found #}
                    <div class="carousel-item active">
                        <div class="row justify-content-center">
                            <div class="col-sm-4 text-center">
                                <div class="upcoming_launch_item">
                                    <img src="https://placehold.co/400x200/EFEFEF/AAAAAA?text=No+Upcoming+Launches" alt="No Upcoming Launches" class="img-fluid product-img mb-3">
                                    <h4 class="mb-2">No Upcoming Launches Yet!</h4>
                                    <p>
                                        Stay tuned for exciting new car reveals.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                {% if upcoming_launches|length > 1 %} {# Show controls only if there's more than one launch #}
                <button class="carousel-control-prev" type="button" data-bs-target="#new_launch_slider" data-bs-slide="prev"> 
                    <i class="fa fa-angle-left"></i>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#new_launch_slider" data-bs-slide="next"> 
                    <i class="fa fa-angle-right"></i>
                    <span class="visually-hidden">Next</span>
                </button>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    {{ block.super }} 
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const mySlider = document.getElementById('my_slider');
            const dynamicBannerBackground = document.getElementById('dynamicBannerBackground');

            // Define your background images matching the order of your carousel items.
            // You will need to replace these placeholder URLs with your actual images.
            const backgroundImages = [
                "{% static 'images/car26.jpg' %}", // For 'Buy Now' (new car)
                "{% static 'images/car27.jpg' %}", // For 'Used Cars'
                "{% static 'images/jobs.png' %}"  // For 'Jobs'
            ];

            // Set initial background image based on the active slide on page load
            const activeItem = mySlider.querySelector('.carousel-item.active');
            let initialIndex = 0;
            if (activeItem) {
                const allItems = Array.from(mySlider.querySelectorAll('.carousel-item'));
                initialIndex = allItems.indexOf(activeItem);
            }
            if (initialIndex < backgroundImages.length) {
                dynamicBannerBackground.style.backgroundImage = `url(${backgroundImages[initialIndex]})`;
            } else {
                // Fallback if index is out of bounds or no images defined
                dynamicBannerBackground.style.backgroundImage = `url('https://placehold.co/1920x1080/EFEFEF/AAAAAA?text=Default+Background')`;
            }

            if (mySlider) {
                mySlider.addEventListener('slide.bs.carousel', function(event) {
                    const nextSlideIndex = event.to;
                    if (nextSlideIndex < backgroundImages.length) {
                        dynamicBannerBackground.style.backgroundImage = `url(${backgroundImages[nextSlideIndex]})`;
                    }
                });
            }
        });
    </script>
{% endblock %}
